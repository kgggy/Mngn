<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="co.mngns.prj.board.map.ReviewMapper">

<!-- criteria 를 적용한 게시판 페이징 조회 -->
<select id="getListWithPaging" resultType="co.mngns.prj.board.vo.ReviewVO">
	select * from review where review_no > 0
	order by review_no desc, reg_dt desc
	limit #{pageStart}, #{perPageNum}
</select>

<select id="reviewSelectList" resultType="co.mngns.prj.board.vo.ReviewVO">
	select review.*, 
		   case review.star_rate when 1 then '★' when 2 then '★★' when 3 then '★★★' when 4 then '★★★★' else '★★★★★' end as star_shape,
		   client.name 
	  from review 
	  left join client on review.client_id = client.client_id
</select>

<select id="myReviewList" resultType="co.mngns.prj.board.vo.ReviewVO">
	select r.*, 
			case r.star_rate when 1 then '★' when 2 then '★★' when 3 then '★★★' when 4 then '★★★★' else '★★★★★' end as star_shape,
			c.name, 	
			case s.knd when 1 then '돌봄 서비스' when 2 then '산책 서비스' else '훈련 서비스' end as knd_name, 
			s.term
	  from reser_list l, svc s, review r, client c
	 where r.reser_no = l.reser_no 
	   and l.client_id2 = c.client_id
	   and s.svc_id = l.svc_id
	   and r.client_id = #{client_id}
</select>

<select id="trnReviewList" resultType="co.mngns.prj.board.vo.ReviewVO">
	select distinct c.name,
			r.cntn, 
			case r.star_rate when 1 then '★' when 2 then '★★' when 3 then '★★★' when 4 then '★★★★' else '★★★★★' end as star_shape, 
			r.reg_dt
	  from trainer t, review r, reser_list l, client c 
 	 where l.client_id2 = t.client_id
		    and l.client_id1 = r.client_id
		    and r.client_id = c.client_id
		    and t.client_id = #{client_id} 
</select>

<delete id="reviewDelete" parameterType="co.mngns.prj.board.vo.ReviewVO">
	delete from review where client_id = #{client_id}
</delete>

<insert id="reviewInsert" parameterType="co.mngns.prj.board.vo.ReviewVO">
	insert into review (review_seq.nextval, cntn, star_rate, reg_dt, file_no, reser_no, client_id)
		   values(#{review_no}, #{cntn}, #{star_rate}, sysdate, #{file_no}, #{reser_no}, #{client_no})
</insert>

</mapper>